<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ke0è¨ˆç®—æ–¹æ³•æ¯”è¼ƒ</title>
    <style>
        body { 
            font-family: Arial, sans-serif; 
            padding: 2rem; 
            max-width: 1200px;
            margin: 0 auto;
        }
        .result { 
            background: #f8f9fa; 
            padding: 1.5rem; 
            margin: 1rem 0; 
            border-radius: 8px; 
            border-left: 4px solid #007bff;
        }
        .comparison {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 2rem;
            margin-top: 2rem;
        }
        .method {
            background: white;
            padding: 1.5rem;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .error { color: #dc3545; }
        .warning { color: #ffc107; }
        .success { color: #28a745; }
        pre { 
            background: #f1f3f4; 
            padding: 1rem; 
            border-radius: 4px; 
            overflow-x: auto;
            font-size: 0.9em;
        }
        .patient-input {
            background: #e3f2fd;
            padding: 1rem;
            border-radius: 8px;
            margin-bottom: 2rem;
        }
        .input-group {
            display: inline-block;
            margin: 0.5rem 1rem 0.5rem 0;
        }
        label {
            display: block;
            font-weight: bold;
            margin-bottom: 0.25rem;
        }
        input, select {
            padding: 0.5rem;
            border: 1px solid #ccc;
            border-radius: 4px;
            width: 100px;
        }
        button {
            background: #007bff;
            color: white;
            border: none;
            padding: 0.75rem 1.5rem;
            border-radius: 4px;
            cursor: pointer;
            margin-top: 1rem;
        }
        button:hover {
            background: #0056b3;
        }
    </style>
</head>
<body>
    <h1>ğŸ§® Ke0è¨ˆç®—æ–¹æ³•æ¯”è¼ƒ</h1>
    
    <div class="patient-input">
        <h3>æ‚£è€…ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿</h3>
        <div class="input-group">
            <label for="age">å¹´é½¢ (æ­³)</label>
            <input type="number" id="age" value="50" min="18" max="100">
        </div>
        <div class="input-group">
            <label for="weight">ä½“é‡ (kg)</label>
            <input type="number" id="weight" value="70" min="30" max="200" step="0.1">
        </div>
        <div class="input-group">
            <label for="height">èº«é•· (cm)</label>
            <input type="number" id="height" value="170" min="120" max="220">
        </div>
        <div class="input-group">
            <label for="sex">æ€§åˆ¥</label>
            <select id="sex">
                <option value="0">ç”·æ€§</option>
                <option value="1">å¥³æ€§</option>
            </select>
        </div>
        <div class="input-group">
            <label for="asa">ASA-PS</label>
            <select id="asa">
                <option value="0">ASA I-II</option>
                <option value="1">ASA III-IV</option>
            </select>
        </div>
        <button onclick="calculateComparison()">è¨ˆç®—å®Ÿè¡Œ</button>
    </div>

    <div id="results"></div>

    <script src="scripts/utils/ke0-masui.js"></script>
    <script>
        function getCurrentPatient() {
            return {
                age: parseInt(document.getElementById('age').value),
                weight: parseFloat(document.getElementById('weight').value),
                height: parseFloat(document.getElementById('height').value),
                sexValue: parseInt(document.getElementById('sex').value),
                asaPSValue: parseInt(document.getElementById('asa').value),
                get bmi() {
                    return this.weight / Math.pow(this.height / 100, 2);
                }
            };
        }

        function calculateComparison() {
            const patient = getCurrentPatient();
            const results = document.getElementById('results');
            
            console.clear();
            console.log('=== Ke0 Calculation Comparison ===');

            results.innerHTML = `
                <div class="result">
                    <h3>æ‚£è€…æƒ…å ±</h3>
                    <p><strong>å¹´é½¢:</strong> ${patient.age}æ­³</p>
                    <p><strong>ä½“é‡:</strong> ${patient.weight}kg</p>
                    <p><strong>èº«é•·:</strong> ${patient.height}cm</p>
                    <p><strong>BMI:</strong> ${patient.bmi.toFixed(1)}</p>
                    <p><strong>æ€§åˆ¥:</strong> ${patient.sexValue === 0 ? 'ç”·æ€§' : 'å¥³æ€§'}</p>
                    <p><strong>ASA-PS:</strong> ${patient.asaPSValue === 0 ? 'ASA I-II' : 'ASA III-IV'}</p>
                </div>
            `;

            // Method 1: Complete Masui Model
            const masuiModel = new MasuiKe0Model();
            const ke0_masui = masuiModel.calculateKe0(patient);
            
            // Method 2: Simplified Model
            const simplifiedModel = new SimplifiedKe0Model();
            const ke0_simplified = simplifiedModel.calculateKe0(patient);

            // Method 3: Current App Model (from enhanced-main.js)
            const ke0_current = calculateCurrentKe0(patient);

            // Create comparison table
            results.innerHTML += `
                <div class="comparison">
                    <div class="method">
                        <h3>ğŸ“š å®Œå…¨ãªMasuiãƒ¢ãƒ‡ãƒ«</h3>
                        <p><strong>ke0:</strong> ${ke0_masui.toFixed(6)} (1/min)</p>
                        <p><strong>t1/2:</strong> ${(Math.log(2)/ke0_masui).toFixed(1)} åˆ†</p>
                        <p><strong>ç‰¹å¾´:</strong> å…¨ã¦ã®äº¤äº’ä½œç”¨é …ã‚’å«ã‚€å®Œå…¨ãªãƒ¢ãƒ‡ãƒ«</p>
                        <p class="${ke0_masui < 0.01 || ke0_masui > 2.0 ? 'error' : 'success'}">
                            ${ke0_masui < 0.01 ? 'å€¤ãŒå°ã•ã™ãã‚‹' : ke0_masui > 2.0 ? 'å€¤ãŒå¤§ãã™ãã‚‹' : 'å¦¥å½“ãªç¯„å›²'}
                        </p>
                    </div>
                    
                    <div class="method">
                        <h3>ğŸ¯ ç°¡ç•¥åŒ–ãƒ¢ãƒ‡ãƒ«</h3>
                        <p><strong>ke0:</strong> ${ke0_simplified.toFixed(6)} (1/min)</p>
                        <p><strong>t1/2:</strong> ${(Math.log(2)/ke0_simplified).toFixed(1)} åˆ†</p>
                        <p><strong>ç‰¹å¾´:</strong> è‡¨åºŠçš„ã«å¦¥å½“ãªç¯„å›²ã«èª¿æ•´</p>
                        <p class="success">è‡¨åºŠä½¿ç”¨ã«é©ã—ã¦ã„ã‚‹</p>
                    </div>
                </div>
                
                <div class="result">
                    <h3>ğŸ”„ ç¾åœ¨ã®ã‚¢ãƒ—ãƒªãƒ¢ãƒ‡ãƒ«</h3>
                    <p><strong>ke0:</strong> ${ke0_current.toFixed(6)} (1/min)</p>
                    <p><strong>t1/2:</strong> ${(Math.log(2)/ke0_current).toFixed(1)} åˆ†</p>
                    <p><strong>ä½¿ç”¨ä¸­:</strong> enhanced-main.jsã§å®Ÿè£…ã•ã‚Œã¦ã„ã‚‹ãƒ¢ãƒ‡ãƒ«</p>
                </div>

                <div class="result">
                    <h3>ğŸ“Š æ¯”è¼ƒçµæœ</h3>
                    <p><strong>å®Œå…¨Masui vs ç°¡ç•¥åŒ–:</strong> ${Math.abs(ke0_masui - ke0_simplified).toFixed(6)} å·®</p>
                    <p><strong>å®Œå…¨Masui vs ç¾åœ¨:</strong> ${Math.abs(ke0_masui - ke0_current).toFixed(6)} å·®</p>
                    <p><strong>ç°¡ç•¥åŒ– vs ç¾åœ¨:</strong> ${Math.abs(ke0_simplified - ke0_current).toFixed(6)} å·®</p>
                </div>

                <div class="result">
                    <h3>ğŸ’¡ æ¨å¥¨äº‹é …</h3>
                    <p>Remimazolamã®å…¸å‹çš„ãªke0å€¤: <strong>0.2-0.4 (1/min)</strong></p>
                    <p>å¯¾å¿œã™ã‚‹å¹³è¡¡æ™‚é–“: <strong>2-4åˆ†</strong></p>
                    <p>æ¨å¥¨ãƒ¢ãƒ‡ãƒ«: <strong>${
                        Math.abs(ke0_simplified - 0.3) < Math.abs(ke0_masui - 0.3) ? 'ç°¡ç•¥åŒ–ãƒ¢ãƒ‡ãƒ«' : 'å®Œå…¨Masuiãƒ¢ãƒ‡ãƒ«'
                    }</strong></p>
                </div>
            `;
        }

        // Current app model for comparison
        function calculateCurrentKe0(patient) {
            const baseKe0 = 0.3;
            const ageRatio = patient.age / 54.0;
            const ageFactor = Math.pow(ageRatio, -0.15);
            const weightRatio = patient.weight / 67.3;
            const weightFactor = Math.pow(weightRatio, -0.1);
            const sexFactor = patient.sexValue === 0 ? 1.0 : 0.9;
            const asaFactor = patient.asaPSValue === 0 ? 1.0 : 0.85;
            const ke0 = baseKe0 * ageFactor * weightFactor * sexFactor * asaFactor;
            return Math.max(0.1, Math.min(0.8, ke0));
        }

        // Initial calculation
        calculateComparison();
    </script>
</body>
</html>